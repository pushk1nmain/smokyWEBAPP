<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SmokyApp - –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</title>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="../../config.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="style.css?v=3.0">
    
    <!-- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –±–æ—Ä—å–±—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
    <meta name="cache-control" content="no-cache">
    <meta name="expires" content="0">
    <meta name="pragma" content="no-cache">
    
    <!-- Meta —Ç–µ–≥–∏ –¥–ª—è Telegram WebApp -->
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
</head>
<body>
    <div class="app-container">
        <!-- –ü–∞—Ä—è—â–∏–µ —Å–º–∞–π–ª–∏–∫–∏ –Ω–∞ —Ñ–æ–Ω–µ -->
        <div class="floating-emojis">
            <span class="emoji emoji-1">üî•</span>
            <span class="emoji emoji-2">üöÄ</span>
            <span class="emoji emoji-3">üö≠</span>
            <span class="emoji emoji-4">üí®</span>
            <span class="emoji emoji-5">üåø</span>
            <span class="emoji emoji-6">üíö</span>
            <span class="emoji emoji-7">ü§ù</span>
            <span class="emoji emoji-8">üìà</span>
            <span class="emoji emoji-9">ü™¥</span>
            <span class="emoji emoji-10">‚è≥</span>
            <span class="emoji emoji-11">üèÜ</span>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
        <main class="welcome-screen">
            <div class="character-section">
                <div class="character-container">
                    <img src="../../elements/photo/smoky_basic.svg" 
                         alt="–°–º–æ–∫–∏ - –≤–∞—à –≥–∏–¥ –∫ –∑–¥–æ—Ä–æ–≤–æ–π –∂–∏–∑–Ω–∏" 
                         class="smoky-character"
                         loading="eager">
                </div>
            </div>
            
            <div class="content-section">
                <h1 class="welcome-title">–ü—Ä–∏–≤–µ—Ç! –Ø –°–º–æ–∫–∏ ‚Äî –≤–∞—à —Ä–æ–±–æ—Ç-–¥—Ä—É–≥ –Ω–∞ –ø—É—Ç–∏ –∫ –∂–∏–∑–Ω–∏ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç</h1>
                
                <p class="welcome-description">
                    –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –ø—É—Ç—å –∫ –∑–¥–æ—Ä–æ–≤–æ–π –∂–∏–∑–Ω–∏?
                </p>
                
                <div class="action-section">
                    <button class="start-button" 
                            id="startButton"
                            tabindex="0" 
                            aria-label="–ù–∞—á–∞—Ç—å –ø—É—Ç—å –∫ –∑–¥–æ—Ä–æ–≤–æ–π –∂–∏–∑–Ω–∏">
                        <span class="button-text">–ü–æ–µ—Ö–∞–ª–∏!</span>
                        <span class="arrow-icon"></span>
                    </button>
                </div>
                
                <div class="info-section">
                    <p class="info-text">
                        <span class="info-icon">üîí</span>
                        –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã
                    </p>
                </div>
            </div>
        </main>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p class="loading-text">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...</p>
        </div>
        
        <!-- –ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–≤–µ—Ä—Ö—É -->
        <div class="dev-console" id="devConsole">
            <div class="dev-console-header">
                <div class="dev-console-title">
                    <span class="dev-console-icon">üîß</span>
                    <span>–ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</span>
                    <span class="dev-console-count" id="logCount">0</span>
                </div>
                <div class="dev-console-controls">
                    <button class="dev-console-btn" id="clearLogs" title="–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏">
                        üóëÔ∏è
                    </button>
                    <button class="dev-console-btn" id="filterToggle" title="–§–∏–ª—å—Ç—Ä—ã">
                        üîç
                    </button>
                </div>
            </div>
            
            <div class="dev-console-filters" id="consoleFilters">
                <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                <button class="filter-btn" data-filter="log">üìù Log</button>
                <button class="filter-btn" data-filter="info">‚ÑπÔ∏è Info</button>
                <button class="filter-btn" data-filter="warn">‚ö†Ô∏è Warn</button>
                <button class="filter-btn" data-filter="error">‚ùå Error</button>
                <button class="filter-btn" data-filter="api">üåê API</button>
            </div>
            
            <div class="dev-console-content" id="consoleContent">
                <div class="dev-console-log startup" data-type="info">
                    <span class="log-time">00:00:00</span>
                    <span class="log-type">‚ÑπÔ∏è</span>
                    <span class="log-message">üöÄ –ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="script.js"></script>
    
    <!-- –í—Ä–µ–º–µ–Ω–Ω–∞—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) -->
    <script>
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SmokyApp...');
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tg = null;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp API
        if (typeof window !== 'undefined' && window.Telegram?.WebApp) {
            tg = window.Telegram.WebApp;
            console.log('‚úÖ Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            tg.ready();
            tg.expand();
            console.log('üì± Telegram WebApp –≥–æ—Ç–æ–≤ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç');
        } else {
            console.warn('‚ö†Ô∏è Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞');
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ API –∑–∞–ø—Ä–æ—Å
        const getUserDataAndPersonalize = async () => {
            console.log('üë§ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            
            let user = null;
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram
            if (tg?.initDataUnsafe?.user) {
                user = tg.initDataUnsafe.user;
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram:', user);
            } else {
                // –ü—Ä–æ–±—É–µ–º –ø–∞—Ä—Å–∏—Ç—å –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.hash.substring(1));
                const tgWebAppData = urlParams.get('tgWebAppData');
                
                if (tgWebAppData) {
                    try {
                        const decodedData = decodeURIComponent(tgWebAppData);
                        const dataParams = new URLSearchParams(decodedData);
                        const userDataStr = dataParams.get('user');
                        
                        if (userDataStr) {
                            user = JSON.parse(decodeURIComponent(userDataStr));
                            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ URL:', user);
                        }
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL:', error);
                    }
                }
            }
            
            if (user) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ API
                const loadingText = document.querySelector('.loading-text');
                if (loadingText) {
                    loadingText.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å...';
                }
                
                try {
                    // API –∑–∞–ø—Ä–æ—Å
                    console.log('üåê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º API –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user.id);
                    const apiUrl = `/api/v1/user/${user.id}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-API-Key': window.SmokyConfig?.api?.apiKey || 'SMOKY-Oz5niTU0yVrHv892BGxotdo2lCK0KtKPp7ypYskFG9CqR2thpSEPgBnxHnkI7WBQ1jYRZLGQ2JJGKLUmV0zYiahamBjtU3DoUmY0Dnp7peZFLwUGMAcgFe0IkT'
                        }
                    });
                    
                    console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç API:', response.status);
                    
                    if (response.ok) {
                        const userData = await response.json();
                        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ API:', userData);
                        
                        // –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                        const titleElement = document.querySelector('.welcome-title');
                        if (titleElement && userData.name) {
                            titleElement.textContent = `–ü—Ä–∏–≤–µ—Ç, ${userData.name}! –Ø –°–º–æ–∫–∏ ‚Äî –≤–∞—à —Ä–æ–±–æ—Ç-–¥—Ä—É–≥ –Ω–∞ –ø—É—Ç–∏ –∫ –∂–∏–∑–Ω–∏ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç`;
                            console.log(`üëã –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è: ${userData.name}`);
                        }
                    } else {
                        console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –∏–∑ Telegram');
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –∏–∑ Telegram
                        const titleElement = document.querySelector('.welcome-title');
                        if (titleElement && user.first_name) {
                            titleElement.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}! –Ø –°–º–æ–∫–∏ ‚Äî –≤–∞—à —Ä–æ–±–æ—Ç-–¥—Ä—É–≥ –Ω–∞ –ø—É—Ç–∏ –∫ –∂–∏–∑–Ω–∏ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç`;
                            console.log(`üëã –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ Telegram –¥–ª—è: ${user.first_name}`);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞:', error);
                    // Fallback –Ω–∞ –∏–º—è –∏–∑ Telegram
                    const titleElement = document.querySelector('.welcome-title');
                    if (titleElement && user.first_name) {
                        titleElement.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}! –Ø –°–º–æ–∫–∏ ‚Äî –≤–∞—à —Ä–æ–±–æ—Ç-–¥—Ä—É–≥ –Ω–∞ –ø—É—Ç–∏ –∫ –∂–∏–∑–Ω–∏ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç`;
                        console.log(`üëã Fallback –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑ Telegram –¥–ª—è: ${user.first_name}`);
                    }
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    console.log('‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä—ã—Ç–∞');
                }, 500);
            }
        };
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–µ—Ö–∞–ª–∏!"
        const handleStartClick = () => {
            console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å —Å –°–º–æ–∫–∏!');
            
            // Haptic feedback –¥–ª—è Telegram
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (tg?.showAlert) {
                tg.showAlert('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SmokyApp! üéâ');
            } else {
                alert('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SmokyApp! üéâ');
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
            const startButton = document.getElementById('startButton');
            if (startButton) {
                startButton.addEventListener('click', handleStartClick);
                startButton.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        handleStartClick();
                    }
                });
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º API –∑–∞–ø—Ä–æ—Å
            await getUserDataAndPersonalize();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ');
        });
        
        console.log('‚úÖ SmokyApp JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html>
