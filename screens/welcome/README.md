# Welcome Screen - Экран приветствия SmokyApp

## Описание
Экран приветствия - это первый экран, который видит пользователь при запуске SmokyApp. Он автоматически открывается при заходе в веб-приложение.

## Структура файлов
```
screens/welcome/
├── index.html      # HTML-структура экрана приветствия
├── style.css       # Стили, оптимизированные для Telegram WebApp
├── script.js       # JavaScript-логика экрана
└── README.md       # Данная документация
```

## Функциональность

### HTML (index.html)
- **Telegram WebApp интеграция**: подключен скрипт Telegram WebApp API
- **Адаптивный дизайн**: оптимизирован для мобильных устройств
- **Персонаж Смоки**: отображение SVG-изображения персонажа
- **Интерактивная кнопка**: кнопка "Поехали!" для начала использования
- **Парящие смайлики**: анимированные эмодзи на фоне
- **Индикатор загрузки**: показывается во время инициализации

### CSS (style.css)
- **Telegram Theme**: поддержка автоматической смены темы из Telegram
- **Мобильная адаптация**: медиа-запросы для разных размеров экранов
- **Анимации**: плавные анимации для персонажа и фоновых элементов
- **Доступность**: поддержка режима уменьшенной анимации
- **BEM методология**: четкая структура классов

### JavaScript (script.js)
- **Telegram WebApp API**: полная интеграция с Telegram
- **API Backend интеграция**: проверка пользователя в базе данных
- **Инициализация**: автоматическая настройка при загрузке
- **Персонализация**: приветствие с именем из БД или Telegram
- **Обработка событий**: клики и клавиатурная навигация
- **Навигация**: переход к следующим экранам приложения
- **Отправка данных**: отправка событий в Telegram бот
- **Обработка ошибок**: graceful fallback при сбоях API

## Автоматическое перенаправление

### Корневая страница (/)
При заходе на корневую страницу (`index.html` в корне проекта) происходит автоматическое перенаправление на экран приветствия:

1. **JavaScript перенаправление**: в `<head>` корневого `index.html`
2. **Nginx перенаправление**: настроено в `nginx.conf`
3. **Файл _redirects**: правила для статических хостингов

### Fallback система
- Первичное перенаправление через JavaScript в `<head>`
- Дополнительная проверка в `script.js`
- Nginx редиректы на уровне сервера
- Временный экран загрузки до перенаправления

## Пути к ресурсам

### Изображения
- Персонаж Смоки: `../../elements/photo/smoky_basic.svg`
- Относительный путь от `screens/welcome/` к корню проекта

### Стили и скрипты
- Стили: `style.css` (локальный файл)
- Скрипт: `script.js` (локальный файл)
- Telegram API: загружается с `https://telegram.org/js/telegram-web-app.js`

## Интеграция с Telegram

### Основные функции
- `Telegram.WebApp.ready()` - уведомление о готовности
- `Telegram.WebApp.expand()` - разворот на весь экран
- `Telegram.WebApp.themeParams` - получение темы Telegram
- `Telegram.WebApp.initDataUnsafe.user` - данные пользователя
- `Telegram.WebApp.HapticFeedback` - тактильная обратная связь
- `Telegram.WebApp.sendData()` - отправка данных в бот

### Режим браузера
Поддерживается работа в обычном браузере для отладки с fallback-настройками и тестовым пользователем.

## Интеграция с Backend API

### Проверка пользователя
При загрузке приложения выполняется автоматическая проверка пользователя:

1. **Получение Telegram ID**: извлекается из `Telegram.WebApp.initDataUnsafe.user.id`
2. **API запрос**: `GET /api/v1/user/{telegram_id}` к backend серверу
3. **Обработка ответа**:
   - **200 OK**: пользователь найден, используется имя из БД
   - **404 Not Found**: пользователь не найден, используется имя из Telegram
   - **Ошибка сети**: fallback на имя из Telegram

### Конфигурация API
```javascript
const API_CONFIG = {
    baseUrl: 'https://api.smokybot.com/api/v1',
    apiKey: 'SMOKY-...' // API ключ из .env файла
};
```

### Заголовки запросов
```javascript
headers: {
    'Content-Type': 'application/json',
    'X-API-Key': API_CONFIG.apiKey
}
```

### Персонализация приветствия
- **Если пользователь в БД**: "Привет, {имя из БД}! Я Смоки..."
- **Если пользователя нет**: "Привет, {имя из Telegram}! Я Смоки..."
- **Fallback**: "Привет! Я Смоки..." (стандартное приветствие)

### Индикаторы загрузки
Во время API запроса отображается индикатор с текстом "Проверяем ваш профиль..."

## Безопасность

### CSP (Content Security Policy)
Настроена в nginx.conf для работы с Telegram WebApp:
- Разрешены скрипты с telegram.org
- Разрешены inline стили для компонентов
- Ограничен доступ к внешним ресурсам

### Заголовки безопасности
- `X-Frame-Options: ALLOWALL` - для работы в Telegram
- `X-Content-Type-Options: nosniff`
- `X-XSS-Protection: 1; mode=block`

## Производительность

### Оптимизации
- Lazy loading для изображений
- Минимизация DOM-манипуляций
- Efficient CSS-анимации с `will-change`
- Кэширование статических ресурсов

### Размер бандла
- Минимальный JavaScript без внешних зависимостей
- Оптимизированный CSS без дублирования
- SVG-иконки вместо растровых изображений

## Тестирование

### Браузерная совместимость
- Chrome/Chromium 80+
- Safari 13+
- Firefox 75+
- Telegram встроенный браузер

### Мобильные устройства
- iOS Safari
- Android Chrome
- Telegram для iOS/Android

## API методы

### window.SmokyWelcome
```javascript
window.SmokyWelcome = {
    isReady: () => boolean,           // Статус готовности
    getTelegram: () => object,        // Объект Telegram WebApp
    getUserData: () => object,        // Данные пользователя
    showNotification: (msg) => void,  // Показ уведомления
    navigateToNextScreen: () => void  // Переход к следующему экрану
}
```

## Будущие улучшения

### Планируемые функции
- Анимированные переходы между экранами
- Поддержка темной темы
- Мультиязычность
- Прогрессивные веб-технологии (PWA)

### Техническая оптимизация
- Внедрение Service Worker
- Кэширование offline
- Предзагрузка следующих экранов
