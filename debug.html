<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - SmokyApp</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #fff; 
            line-height: 1.6;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .warning { background: #5a5a2d; }
        pre { 
            background: #2d2d2d; 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto; 
        }
        button { 
            background: #007AFF; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
    </style>
</head>
<body>
    <h1>üîß SmokyApp Debug Console</h1>
    
    <div id="status">
        <div class="status warning">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <h2>üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª–µ–π:</h2>
    <div id="modules"></div>

    <h2>üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h2>
    <button onclick="testTelegramManager()">–¢–µ—Å—Ç TelegramManager</button>
    <button onclick="testAPI()">–¢–µ—Å—Ç API</button>
    <button onclick="testRouter()">–¢–µ—Å—Ç Router</button>
    <button onclick="initApp()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è App</button>

    <h2>üìù –õ–æ–≥–∏:</h2>
    <pre id="logs"></pre>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script>
        console.log('‚úÖ Utils –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
    
    <script src="js/telegram.js"></script>
    <script>
        console.log('‚úÖ Telegram –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
    
    <script src="js/api.js"></script>
    <script>
        console.log('‚úÖ API –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
    
    <script src="js/router.js"></script>
    <script>
        console.log('‚úÖ Router –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
    
    <script src="js/app.js"></script>
    <script>
        console.log('‚úÖ App –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>

    <script>
        // Debug —Ñ—É–Ω–∫—Ü–∏–∏
        const statusDiv = document.getElementById('status');
        const modulesDiv = document.getElementById('modules');
        const logsDiv = document.getElementById('logs');
        
        let logs = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            logsDiv.textContent = logs.slice(-20).join('\n');
            console.log(logEntry);
        }
        
        function checkModules() {
            const modules = {
                'Utils': typeof window.Utils,
                'TelegramManager': typeof window.TelegramManager,
                'TelegramManager.initialize': typeof window.TelegramManager?.initialize,
                'API': typeof window.API,
                'Router': typeof window.Router,
                'BaseScreen': typeof window.BaseScreen,
                'SmokyApp': typeof window.SmokyApp
            };
            
            let html = '';
            for (const [name, type] of Object.entries(modules)) {
                const status = type === 'undefined' ? 'error' : 
                              type === 'function' || type === 'object' ? 'success' : 'warning';
                html += `<div class="status ${status}">${name}: ${type}</div>`;
            }
            
            modulesDiv.innerHTML = html;
            return modules;
        }
        
        function testTelegramManager() {
            addLog('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TelegramManager...');
            
            try {
                if (!window.TelegramManager) {
                    throw new Error('TelegramManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                if (typeof TelegramManager.initialize !== 'function') {
                    throw new Error('TelegramManager.initialize –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π');
                }
                
                addLog('TelegramManager –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                
                // –ü—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                TelegramManager.initialize().then(() => {
                    addLog('TelegramManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                }).catch(err => {
                    addLog(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TelegramManager: ${err.message}`, 'error');
                });
                
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ TelegramManager: ${error.message}`, 'error');
            }
        }
        
        function testAPI() {
            addLog('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            
            try {
                if (!window.API) {
                    throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                addLog('API –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                
                // –ü—Ä–æ–±—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                API.initializeUser(123456789).then(result => {
                    addLog(`API —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω: ${JSON.stringify(result)}`, 'success');
                }).catch(err => {
                    addLog(`–û—à–∏–±–∫–∞ API: ${err.message}`, 'warning');
                });
                
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ API: ${error.message}`, 'error');
            }
        }
        
        function testRouter() {
            addLog('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Router...');
            
            try {
                if (!window.Router) {
                    throw new Error('Router –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                addLog('Router –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                addLog(`–¢–µ–∫—É—â–∏–π —à–∞–≥: ${Router.getCurrentStep()}`);
                
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ Router: ${error.message}`, 'error');
            }
        }
        
        function initApp() {
            addLog('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            try {
                if (!window.SmokyApp) {
                    throw new Error('SmokyApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                SmokyApp.initialize().then(() => {
                    addLog('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ', 'success');
                    statusDiv.innerHTML = '<div class="status success">‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>';
                }).catch(err => {
                    addLog(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${err.message}`, 'error');
                    statusDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${err.message}</div>`;
                });
                
            } catch (error) {
                addLog(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                statusDiv.innerHTML = `<div class="status error">‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            addLog('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            checkModules();
            
            setTimeout(() => {
                addLog('–ê–≤—Ç–æ—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É...');
                testTelegramManager();
            }, 1000);
        });
        
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º console.error –¥–ª—è –æ—Ç–ª–æ–≤–∞ –æ—à–∏–±–æ–∫
        const originalError = console.error;
        console.error = function(...args) {
            addLog(args.join(' '), 'error');
            originalError.apply(console, args);
        };
    </script>
</body>
</html>
