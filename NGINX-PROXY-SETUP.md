# üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SmokyApp —Å –≤–Ω–µ—à–Ω–∏–º nginx

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å nginx –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
cp docker-compose-proxy.yml docker-compose.yml

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
docker network create nginx-proxy

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ä—Ç–æ–≤)
docker-compose up -d --build
```

### –®–∞–≥ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
sudo ./scripts/setup-ssl.sh

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç certbot (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# - –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
# - –ù–∞—Å—Ç—Ä–æ–∏—Ç nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# - –ù–∞—Å—Ç—Ä–æ–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl -f https://–≤–∞—à-–¥–æ–º–µ–Ω.com/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps
```

## ‚öôÔ∏è –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose-proxy.yml` –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ `docker-compose.yml`:

```yaml
# –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è:
- –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ä—Ç–æ–≤ (80/443)
- –¢–æ–ª—å–∫–æ expose: ["80"] –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏ nginx-proxy
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ Docker —Å–µ—Ç–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –æ–±—â—É—é —Å–µ—Ç—å –¥–ª—è nginx –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker network create nginx-proxy

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ
docker network ls | grep nginx-proxy
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `nginx-proxy.conf` –≤ –≤–∞—à nginx:

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cp nginx-proxy.conf /etc/nginx/sites-available/smokyapp

# –ó–∞–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω—ã –Ω–∞ –≤–∞—à–∏
sudo sed -i 's/your-domain.com/–≤–∞—à-–¥–æ–º–µ–Ω.com/g' /etc/nginx/sites-available/smokyapp

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo ln -s /etc/nginx/sites-available/smokyapp /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
sudo nginx -t
sudo systemctl reload nginx
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
sudo ./scripts/setup-ssl.sh
```

#### –í—Ä—É—á–Ω—É—é:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å certbot
sudo apt install certbot python3-certbot-nginx  # Ubuntu/Debian
sudo yum install certbot python3-certbot-nginx  # CentOS

# –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot --nginx -d –≤–∞—à-–¥–æ–º–µ–Ω.com -d www.–≤–∞—à-–¥–æ–º–µ–Ω.com

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### docker-compose-proxy.yml

- ‚úÖ –£–±—Ä–∞–Ω—ã –≤–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã 80/443
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω expose: ["80"] –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ nginx-proxy
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### nginx-proxy.conf

- ‚úÖ HTTP -> HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è Telegram Web App
- ‚úÖ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É smokyapp-web:80
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–Ω–∞ –±—É–¥—É—â–µ–µ)

### scripts/setup-ssl.sh

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ certbot
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ Docker —Å–µ—Ç–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üåê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–º–µ–Ω–æ–≤

```
https://–≤–∞—à-–¥–æ–º–µ–Ω.com          -> smokyapp-web:80 (–æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
https://www.–≤–∞—à-–¥–æ–º–µ–Ω.com      -> smokyapp-web:80 (—Å www)
https://api.–≤–∞—à-–¥–æ–º–µ–Ω.com      -> –≥–æ—Ç–æ–≤–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ API
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ Docker

```bash
# –°–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π
docker network ls

# –î–µ—Ç–∞–ª–∏ —Å–µ—Ç–∏ nginx-proxy
docker network inspect nginx-proxy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker inspect smokyapp-web | grep NetworkMode
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx

```bash
# –°—Ç–∞—Ç—É—Å nginx
sudo systemctl status nginx

# –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –õ–æ–≥–∏ nginx
sudo tail -f /var/log/nginx/smokyapp_*.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot certificates

# –¢–µ—Å—Ç SSL
echo | openssl s_client -servername –≤–∞—à-–¥–æ–º–µ–Ω.com -connect –≤–∞—à-–¥–æ–º–µ–Ω.com:443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (dry-run)
sudo certbot renew --dry-run
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∏–∑ —Ö–æ—Å—Ç–∞)
docker exec smokyapp-web curl -f http://localhost/health

# –í–Ω–µ—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl -f https://–≤–∞—à-–¥–æ–º–µ–Ω.com/health

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs -f smokyapp
```

## üöÄ –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```bash
# 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
cp docker-compose-proxy.yml docker-compose.yml

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
sudo ./scripts/setup-ssl.sh

# 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose up -d --build

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl -f https://–≤–∞—à-–¥–æ–º–µ–Ω.com/health
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./update-frontend.sh

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã
./scripts/update.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
./scripts/watch.sh start
```

## üéØ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ nginx
sudo systemctl reload nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose restart smokyapp

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤
sudo tail -f /var/log/nginx/smokyapp_*.log
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tulpn | grep :80
netstat -tulpn | grep :443

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
curl -w "@curl-format.txt" -o /dev/null -s https://–≤–∞—à-–¥–æ–º–µ–Ω.com/
```

---

**–ì–æ—Ç–æ–≤–æ! –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ nginx –ø—Ä–æ–∫—Å–∏ —Å SSL! üîí‚ú®**
