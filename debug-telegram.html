<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp Debug</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        .debug-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 10px 0;
        }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        h3 { color: #555; margin-top: 20px; margin-bottom: 10px; }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            width: 100%;
        }
        .btn:hover { background: #0056CC; }
        .timestamp { font-size: 12px; color: #666; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Telegram WebApp Debug</h1>
        <div class="timestamp" id="timestamp"></div>
        
        <div id="status-container">
            <div class="info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        </div>
        
        <div id="debug-info"></div>
        
        <button class="btn" onclick="reloadDebug()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
        <button class="btn" onclick="closeApp()" id="close-btn" style="display:none;">‚ùå –ó–∞–∫—Ä—ã—Ç—å WebApp</button>
    </div>

    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        console.log('üöÄ Debug script started');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
        document.getElementById('timestamp').textContent = '–ó–∞–ø—É—â–µ–Ω–æ: ' + new Date().toLocaleString('ru-RU');
        
        let debugInfo = '';
        let statusContainer = document.getElementById('status-container');
        let debugContainer = document.getElementById('debug-info');
        
        function addStatus(type, message) {
            console.log(`[${type.toUpperCase()}] ${message}`);
            statusContainer.innerHTML += `<div class="${type}">${message}</div>`;
        }
        
        function addDebugInfo(title, data) {
            debugInfo += `<h3>${title}</h3><div class="code">${JSON.stringify(data, null, 2)}</div>`;
            debugContainer.innerHTML = debugInfo;
        }
        
        function reloadDebug() {
            location.reload();
        }
        
        function closeApp() {
            if (window.Telegram?.WebApp?.close) {
                window.Telegram.WebApp.close();
            } else {
                addStatus('error', '–ú–µ—Ç–æ–¥ close() –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        // –ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
        setTimeout(() => {
            try {
                addStatus('info', '–ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É Telegram WebApp...');
                
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
                const hasTelegram = !!window.Telegram;
                const hasWebApp = !!window.Telegram?.WebApp;
                
                addStatus(hasTelegram ? 'success' : 'error', 
                    `window.Telegram: ${hasTelegram ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–ï –î–û–°–¢–£–ü–ï–ù'}`);
                addStatus(hasWebApp ? 'success' : 'error', 
                    `window.Telegram.WebApp: ${hasWebApp ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–ï –î–û–°–¢–£–ü–ï–ù'}`);
                
                if (!hasWebApp) {
                    addStatus('error', '–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
                    return;
                }
                
                // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é
                const version = window.Telegram.WebApp.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const isVersion6Plus = window.Telegram.WebApp.isVersionAtLeast && 
                                     window.Telegram.WebApp.isVersionAtLeast('6.0');
                
                addStatus('info', `–í–µ—Ä—Å–∏—è WebApp: ${version}`);
                addStatus(isVersion6Plus ? 'success' : 'warning', 
                    `–í–µ—Ä—Å–∏—è 6.0+: ${isVersion6Plus ? '–î–∞' : '–ù–µ—Ç'}`);
                
                // 3. –í—ã–∑—ã–≤–∞–µ–º ready() - –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!
                addStatus('info', '–í—ã–∑—ã–≤–∞–µ–º Telegram.WebApp.ready()...');
                window.Telegram.WebApp.ready();
                addStatus('success', 'Telegram.WebApp.ready() –≤—ã–ø–æ–ª–Ω–µ–Ω');
                
                // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º initData –ü–û–°–õ–ï ready()
                setTimeout(() => {
                    const initData = window.Telegram.WebApp.initData;
                    const initDataUnsafe = window.Telegram.WebApp.initDataUnsafe;
                    const hasInitData = !!(initData && initData.length > 0);
                    const hasUser = !!(initDataUnsafe && initDataUnsafe.user);
                    
                    addStatus(hasInitData ? 'success' : 'error', 
                        `initData: ${hasInitData ? '–ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç' : '–û–¢–°–£–¢–°–¢–í–£–Æ–¢'}`);
                    addStatus(hasUser ? 'success' : 'error', 
                        `initDataUnsafe.user: ${hasUser ? '–ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç' : '–û–¢–°–£–¢–°–¢–í–£–ï–¢'}`);
                    
                    // 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    addDebugInfo('üîß –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞', {
                        'User Agent': navigator.userAgent,
                        'URL': window.location.href,
                        'Referrer': document.referrer,
                        'Telegram.WebApp.version': window.Telegram.WebApp.version,
                        'Telegram.WebApp.platform': window.Telegram.WebApp.platform,
                        'Telegram.WebApp.colorScheme': window.Telegram.WebApp.colorScheme,
                        'initData (length)': initData ? initData.length : 0,
                        'initData (first 100 chars)': initData ? initData.substring(0, 100) + '...' : '–ü—É—Å—Ç—ã–µ',
                        'initDataUnsafe': initDataUnsafe,
                        'viewportHeight': window.Telegram.WebApp.viewportHeight,
                        'viewportStableHeight': window.Telegram.WebApp.viewportStableHeight,
                        'isExpanded': window.Telegram.WebApp.isExpanded,
                        'themeParams': window.Telegram.WebApp.themeParams
                    });
                    
                    // 6. –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
                    if (hasInitData && hasUser) {
                        addStatus('success', '‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –£–°–ü–ï–®–ù–û!');
                        document.getElementById('close-btn').style.display = 'block';
                        
                        // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å—à–∏—Ä–∏—Ç—å viewport
                        try {
                            window.Telegram.WebApp.expand();
                            addStatus('success', 'Viewport —Ä–∞—Å—à–∏—Ä–µ–Ω');
                        } catch (e) {
                            addStatus('warning', '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ä–∏—Ç—å viewport: ' + e.message);
                        }
                        
                    } else {
                        addStatus('error', '‚ùå –ü–†–û–ë–õ–ï–ú–ê: initData –∏–ª–∏ user –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!');
                        addStatus('warning', '–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:');
                        addStatus('warning', '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ –±–æ—Ç–µ');
                        addStatus('warning', '‚Ä¢ URL –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ @BotFather');
                        addStatus('warning', '‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º');
                        addStatus('warning', '‚Ä¢ –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è Telegram');
                    }
                    
                }, 100); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É ready()
                
            } catch (error) {
                addStatus('error', '–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ' + error.message);
                addDebugInfo('üí• –û—à–∏–±–∫–∞', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
            }
        }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        
    </script>
</body>
</html>