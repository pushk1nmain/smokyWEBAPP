<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug TelegramManager</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .debug-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007AFF;
        }
        .success { border-left-color: #34C759; }
        .error { border-left-color: #FF3B30; }
        .warning { border-left-color: #FF9500; }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        pre {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîß Debug TelegramManager</h1>
    
    <div class="debug-section">
        <h3>–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤</h3>
        <div id="script-status"></div>
    </div>
    
    <div class="debug-section">
        <h3>TelegramManager Status</h3>
        <div id="telegram-manager-status"></div>
        <button onclick="checkTelegramManager()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TelegramManager</button>
        <button onclick="testInitialize()">üöÄ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
    </div>
    
    <div class="debug-section">
        <h3>Telegram WebApp API</h3>
        <div id="telegram-api-status"></div>
        <button onclick="checkTelegramAPI()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram API</button>
    </div>
    
    <div class="debug-section">
        <h3>–ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏</h3>
        <pre id="console-logs"></pre>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ —á—Ç–æ –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/telegram.js"></script>
    
    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const logsContainer = document.getElementById('console-logs');
        
        function addLog(type, message, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message} ${args.length ? JSON.stringify(args) : ''}`;
            logsContainer.textContent += logEntry + '\n';
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        console.log = function(message, ...args) {
            addLog('log', message, ...args);
            originalLog.apply(console, [message, ...args]);
        };
        
        console.error = function(message, ...args) {
            addLog('error', message, ...args);
            originalError.apply(console, [message, ...args]);
        };
        
        console.warn = function(message, ...args) {
            addLog('warn', message, ...args);
            originalWarn.apply(console, [message, ...args]);
        };

        /**
         * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
         */
        function checkScriptStatus() {
            const status = document.getElementById('script-status');
            
            const checks = [
                { name: 'Telegram WebApp API', check: () => !!window.Telegram?.WebApp },
                { name: 'Utils', check: () => !!window.Utils },
                { name: 'API', check: () => !!window.API },
                { name: 'TelegramManager', check: () => !!window.TelegramManager }
            ];
            
            let html = '<ul>';
            checks.forEach(item => {
                const result = item.check();
                const icon = result ? '‚úÖ' : '‚ùå';
                const className = result ? 'success' : 'error';
                html += `<li class="${className}">${icon} ${item.name}: ${result}</li>`;
            });
            html += '</ul>';
            
            status.innerHTML = html;
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è TelegramManager
         */
        function checkTelegramManager() {
            const status = document.getElementById('telegram-manager-status');
            
            if (!window.TelegramManager) {
                status.innerHTML = '<div class="error">‚ùå TelegramManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                return;
            }
            
            const checks = [
                { name: '–û–±—ä–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', value: !!window.TelegramManager },
                { name: 'initialize –¥–æ—Å—Ç—É–ø–µ–Ω', value: typeof window.TelegramManager.initialize === 'function' },
                { name: 'isReady –¥–æ—Å—Ç—É–ø–µ–Ω', value: typeof window.TelegramManager.isReady === 'function' },
                { name: 'webApp –¥–æ—Å—Ç—É–ø–µ–Ω', value: window.TelegramManager.webApp !== null },
                { name: 'isInitialized', value: window.TelegramManager.isInitialized },
                { name: 'user –¥–∞–Ω–Ω—ã–µ', value: !!window.TelegramManager.user }
            ];
            
            let html = '<ul>';
            checks.forEach(item => {
                const icon = item.value ? '‚úÖ' : '‚ùå';
                const className = item.value ? 'success' : 'warning';
                html += `<li class="${className}">${icon} ${item.name}: ${item.value}</li>`;
            });
            html += '</ul>';
            
            status.innerHTML = html;
        }

        /**
         * –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TelegramManager
         */
        async function testInitialize() {
            console.log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TelegramManager...');
            
            if (!window.TelegramManager) {
                console.error('‚ùå TelegramManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            try {
                console.log('üìû –í—ã–∑–æ–≤ TelegramManager.initialize()...');
                const result = await window.TelegramManager.initialize();
                console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', result);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                setTimeout(() => {
                    checkTelegramManager();
                    checkTelegramAPI();
                }, 100);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp API
         */
        function checkTelegramAPI() {
            const status = document.getElementById('telegram-api-status');
            
            if (!window.Telegram?.WebApp) {
                status.innerHTML = '<div class="error">‚ùå Telegram WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                return;
            }
            
            const webApp = window.Telegram.WebApp;
            
            const apiInfo = [
                { name: 'ready()', available: typeof webApp.ready === 'function' },
                { name: 'expand()', available: typeof webApp.expand === 'function' },
                { name: 'close()', available: typeof webApp.close === 'function' },
                { name: 'MainButton', available: !!webApp.MainButton },
                { name: 'BackButton', available: !!webApp.BackButton },
                { name: 'HapticFeedback', available: !!webApp.HapticFeedback },
                { name: 'initData', available: !!webApp.initData || webApp.initData === '' },
                { name: 'initDataUnsafe', available: !!webApp.initDataUnsafe }
            ];
            
            let html = '<ul>';
            apiInfo.forEach(item => {
                const icon = item.available ? '‚úÖ' : '‚ùå';
                const className = item.available ? 'success' : 'warning';
                html += `<li class="${className}">${icon} ${item.name}</li>`;
            });
            html += '</ul>';
            
            status.innerHTML = html;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîß Debug —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
            setTimeout(() => {
                checkScriptStatus();
                checkTelegramManager();
                checkTelegramAPI();
            }, 500);
        });
    </script>
</body>
</html>
