<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmokyApp - –ü—É—Ç—å –∫ —Å–≤–æ–±–æ–¥–µ –æ—Ç –∫—É—Ä–µ–Ω–∏—è</title>
    
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js" onerror="console.warn('Telegram WebApp script –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω')"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Preload –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app" class="app">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        <div id="progress-bar" class="progress-bar">
            <div class="progress-bar__fill" id="progress-fill"></div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ -->
        <main id="screen-container" class="screen-container">
            <!-- –≠–∫—Ä–∞–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </main>
        
        <!-- Overlay –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <p class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification-container" class="notification-container"></div>
    </div>

    <!-- Core Scripts –°–ù–ê–ß–ê–õ–ê - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/router.js"></script>
    
    <!-- Telegram –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ -->
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Telegram WebApp
        if (window.Telegram?.WebApp) {
            console.log('üîÑ Telegram WebApp –≥–æ—Ç–æ–≤ –∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
            window.Telegram.WebApp.ready();
        } else {
            console.warn('‚ö†Ô∏è Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ TelegramManager
        function waitForTelegramManager() {
            return new Promise((resolve) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ–±—ä–µ–∫—Ç, –∏ —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏
                if (window.TelegramManager && window.TelegramManagerLoaded) {
                    console.log('‚úÖ TelegramManager –¥–æ—Å—Ç—É–ø–µ–Ω —Å—Ä–∞–∑—É');
                    resolve(true);
                    return;
                }
                
                console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ TelegramManager...');
                let attempts = 0;
                const maxAttempts = 50; // 5 —Å–µ–∫—É–Ω–¥
                
                const checkInterval = setInterval(() => {
                    attempts++;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                    if (attempts % 10 === 0) {
                        console.log(`   –ü–æ–ø—ã—Ç–∫–∞ ${attempts}: TelegramManager=${!!window.TelegramManager}, —Ñ–ª–∞–≥=${!!window.TelegramManagerLoaded}`);
                    }
                    
                    if (window.TelegramManager && window.TelegramManagerLoaded) {
                        console.log(`‚úÖ TelegramManager –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ ${attempts * 100}ms`);
                        clearInterval(checkInterval);
                        resolve(true);
                    } else if (attempts >= maxAttempts) {
                        console.error('‚ùå TelegramManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ 5 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è');
                        console.error('   –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:', {
                            hasTelegramManager: !!window.TelegramManager,
                            hasTelegramManagerLoaded: !!window.TelegramManagerLoaded,
                            hasWindow: !!window,
                            documentReady: document.readyState
                        });
                        clearInterval(checkInterval);
                        resolve(false);
                    }
                }, 100);
            });
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π
        window.waitForTelegramManager = waitForTelegramManager;
    </script>
    
    <!-- app.js –ü–û–°–õ–ï–î–ù–ò–ú -->
    <script src="js/app.js"></script>
</body>
</html>
