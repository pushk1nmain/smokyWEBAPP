<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmokyApp - –û—Ç–ª–∞–¥–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Preload –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--color-surface);
            border: 2px solid var(--color-accent);
            border-radius: var(--radius-lg);
            padding: var(--spacing-4);
            box-shadow: var(--shadow-3);
            z-index: 10001;
            font-size: var(--font-size-sm);
            max-width: 300px;
        }
        
        .debug-panel h3 {
            margin: 0 0 var(--spacing-3) 0;
            color: var(--color-accent);
            font-size: var(--font-size-base);
        }
        
        .debug-info {
            margin-bottom: var(--spacing-2);
        }
        
        .debug-info strong {
            color: var(--color-text-primary);
        }
        
        .debug-status {
            padding: var(--spacing-1) var(--spacing-2);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }
        
        .debug-status--ok {
            background: var(--color-success);
            color: var(--color-text-inverse);
        }
        
        .debug-status--warning {
            background: var(--color-warning);
            color: var(--color-text-inverse);
        }
        
        .debug-status--error {
            background: var(--color-error);
            color: var(--color-text-inverse);
        }
        
        .debug-actions {
            margin-top: var(--spacing-4);
            display: flex;
            gap: var(--spacing-2);
        }
        
        .debug-btn {
            padding: var(--spacing-1) var(--spacing-2);
            border: none;
            border-radius: var(--radius-sm);
            background: var(--color-accent);
            color: var(--color-text-inverse);
            font-size: var(--font-size-xs);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app" class="app">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        <div id="progress-bar" class="progress-bar">
            <div class="progress-bar__fill" id="progress-fill"></div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ -->
        <main id="screen-container" class="screen-container">
            <!-- –≠–∫—Ä–∞–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </main>
        
        <!-- Overlay –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <p class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification-container" class="notification-container"></div>
        
        <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="debug-panel" id="debug-panel">
            <h3>üîß –û—Ç–ª–∞–¥–∫–∞</h3>
            <div class="debug-info">
                <strong>–†–µ–∂–∏–º:</strong> <span class="debug-status debug-status--warning">–ë—Ä–∞—É–∑–µ—Ä</span>
            </div>
            <div class="debug-info">
                <strong>Telegram API:</strong> <span id="debug-telegram-api" class="debug-status debug-status--error">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
            </div>
            <div class="debug-info">
                <strong>TelegramManager:</strong> <span id="debug-telegram-manager" class="debug-status debug-status--error">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
            </div>
            <div class="debug-info">
                <strong>–¢–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω:</strong> <span id="debug-current-screen">-</span>
            </div>
            <div class="debug-info">
                <strong>–®–∞–≥:</strong> <span id="debug-current-step">-</span>
            </div>
            
            <div class="debug-actions">
                <button class="debug-btn" onclick="debugShowNotification()">–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                <button class="debug-btn" onclick="debugClearStorage()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
        </div>
    </div>

    <!-- Mock Telegram API (—Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞) -->
    <script>
        // –°–æ–∑–¥–∞–µ–º mock Telegram API —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
        if (!window.Telegram) {
            window.Telegram = {
                WebApp: {
                    ready: () => console.log('Mock: WebApp ready'),
                    expand: () => console.log('Mock: WebApp expand'),
                    close: () => console.log('Mock: WebApp close'),
                    sendData: (data) => console.log('Mock sendData:', data),
                    MainButton: {
                        show: () => console.log('Mock: MainButton show'),
                        hide: () => console.log('Mock: MainButton hide'),
                        setText: (text) => console.log('Mock: MainButton setText:', text),
                        enable: () => console.log('Mock: MainButton enable'),
                        disable: () => console.log('Mock: MainButton disable')
                    },
                    BackButton: {
                        show: () => console.log('Mock: BackButton show'),
                        hide: () => console.log('Mock: BackButton hide')
                    },
                    HapticFeedback: {
                        impactOccurred: (type) => console.log('Mock haptic impact:', type),
                        notificationOccurred: (type) => console.log('Mock haptic notification:', type)
                    },
                    initDataUnsafe: {
                        user: {
                            id: 123456789,
                            first_name: '–¢–µ—Å—Ç',
                            last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                            username: 'testuser',
                            language_code: 'ru'
                        }
                    },
                    initData: null, // –ù–µ—Ç initData –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                    onEvent: (event, handler) => {
                        console.log(`Mock event listener: ${event}`);
                    },
                    isVersionAtLeast: (version) => true,
                    themeParams: {},
                    viewportWidth: window.innerWidth,
                    viewportHeight: window.innerHeight,
                    viewportStableHeight: window.innerHeight
                }
            };
        }
        
        // –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        const debugShowNotification = () => {
            if (window.Utils) {
                window.Utils.showNotification('–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', 'success');
            }
        };
        
        const debugClearStorage = () => {
            if (window.Utils) {
                window.Utils.removeFromStorage('userData');
                window.Utils.removeFromStorage('appState');
                window.Utils.showNotification('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'info');
                setTimeout(() => location.reload(), 1000);
            }
        };
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –ø–∞–Ω–µ–ª–∏
        const updateDebugPanel = () => {
            const telegramApiStatus = document.getElementById('debug-telegram-api');
            const telegramManagerStatus = document.getElementById('debug-telegram-manager');
            const currentScreen = document.getElementById('debug-current-screen');
            const currentStep = document.getElementById('debug-current-step');
            
            if (telegramApiStatus) {
                if (window.Telegram?.WebApp) {
                    telegramApiStatus.textContent = 'Mock';
                    telegramApiStatus.className = 'debug-status debug-status--warning';
                } else {
                    telegramApiStatus.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                    telegramApiStatus.className = 'debug-status debug-status--error';
                }
            }
            
            if (telegramManagerStatus) {
                if (window.TelegramManager) {
                    telegramManagerStatus.textContent = '–ì–æ—Ç–æ–≤';
                    telegramManagerStatus.className = 'debug-status debug-status--ok';
                } else {
                    telegramManagerStatus.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                    telegramManagerStatus.className = 'debug-status debug-status--error';
                }
            }
            
            if (currentScreen && window.Router) {
                const screen = window.Router.getCurrentScreen();
                currentScreen.textContent = screen?.name || '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            }
            
            if (currentStep && window.Router) {
                const step = window.Router.getCurrentStep();
                currentStep.textContent = step !== undefined ? step : '-';
            }
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateDebugPanel, 2000);
    </script>

    <!-- Core Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
